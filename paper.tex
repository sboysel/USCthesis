\documentclass[12pt]{report}
\usepackage[
  dissertation
 ,final
 ,raggedbottom
%,tocbold        % uncomment to enable bold chapter titles in the ToC
                 %
                 % the style guidelines state that page numbers in the
                 % ToC should not be bold, but leave it up to the author
                 % and specific department guidelines as to how the
                 % chapter (or other section) titles should be typeset.
]{USCthesis}

% guidelines for manuscript formatting: https://graduateschool.usc.edu/wp-content/uploads/2020/11/Manuscript_Formatting_and_Documentation_Styles.pdf

%% our customizations %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[export]{adjustbox} % for frame option in \includegraphics
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{array}
\usepackage[utf8]{inputenc} % load inputenc before csquotes
\usepackage[english]{babel}
\usepackage[
  backend     = biber,
  citestyle   = authoryear,
  doi         = true,
  hyperref    = true,
  maxbibnames = 99,
  natbib      = true,
  sortlocale  = en_US,
  style       = authoryear,
]{biblatex}
\usepackage{booktabs}
\usepackage{color, colortbl}
\usepackage{csquotes}
\usepackage{efbox}
\usepackage{enumitem}
\usepackage[shortcuts]{extdash} % use `\-/' to hyphenate words/phrases that have a dash in them
% \usepackage[tt=false]{libertine} % libertine's \ttfamily isn't that great
\usepackage[T1]{fontenc} % load fonts before fontenc
%\usepackage[symbol]{footmisc}
\usepackage{footmisc}
\usepackage[
  showframe = false,% draw a border around textwidth
  pass      = true, % force 8.5"x11" pagesize
]{geometry}
\usepackage{graphicx}
%\usepackage[notquote]{hanging} % enables negative indents in paragraphs
\usepackage{hyphenat}
\usepackage{ifthen}
\usepackage{lipsum}
\usepackage{multirow}
\usepackage{parnotes}
\usepackage{pdflscape} % rotate some pages in an {landscape} environment
\usepackage{pifont}
\usepackage{ragged2e}
\usepackage{seqsplit}
\usepackage{siunitx}
\usepackage{subcaption}
\usepackage{tabularx}
\usepackage{xcolor}
\usepackage{xspace}
\usepackage{url}

\usepackage[
  bookmarks     = true,
  breaklinks    = true,
  colorlinks    = true,
  hypertexnames = false,
  pdfpagelabels = false,
  citecolor     = {blue!80!black},
  linkcolor     = {blue!80!black},
  urlcolor      = {blue!80!black},
]{hyperref} % load hyperref as the last package

% pkg: biblatex
\setlength\bibitemsep{0.5\baselineskip}                 % add a line between entries
\AtEveryBibitem{\iffieldundef{doi}{}{\clearfield{url}}} % if DOI, hide URL

% \addbibresource{paper.bib}

% pkg: siunitx
% some guidelines https://physics.nist.gov/cuu/Units/checklist.html
\sisetup{
  tight-spacing  = true
  ,detect-family = true
  ,detect-mode   = true
  ,binary-units  = true    % support for MB, GB, etc.
  ,range-units   = single  % "3% to 5%" -> "3 to 5%"
  ,range-phrase  = --      % "3 to 5%"  -> "3--5%"
}

% pkg: babel, hyperref
\addto\extrasenglish{%
  \renewcommand{\chapterautorefname}{Chapter}
  \renewcommand{\sectionautorefname}{Section}
  \renewcommand{\subsectionautorefname}{Section}
  \renewcommand{\subsubsectionautorefname}{Section}
}

% pkg: url
\renewcommand{\UrlFont}{\footnotesize\tt}

% our custom commands
\renewcommand{\ttdefault}{cmtt} % use computer modern for teletype

%%% draft mode / toggle commands %%%
\usepackage{etoolbox}
\newtoggle{draft}
\settoggle{draft}{true} % change toggle for draft or final versions

\iftoggle{draft}{
  % if 'draft' toggle is true
  \overfullrule=10pt                       % highlight overfull hboxes
}{
  % if 'draft' toggle is false
  \PassOptionsToPackage{final}{showlabels} % hide labels on figures, etc
}

% if you're including existing papers into your thesis, it helps to put
% content behind a toggle (or conditional) so you only have to maintain
% and keep consistency on one copy. see "introduction.tex".
\newtoggle{thesis}
\settoggle{thesis}{true}

\usepackage[inline]{showlabels}
\renewcommand{\showlabelfont}{\sffamily \color{blue}}
\renewcommand{\showlabelsetlabel}[1]{\efbox{\showlabelfont #1}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% sboysel customization %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\usepackage[margin=1in]{geometry}
%\usepackage{lipsum}
%\usepackage{abstract}
\usepackage{amsfonts}
%\usepackage{amssymb}
\usepackage{amsthm}
%\usepackage{amsmath}
\usepackage{bm}
\usepackage{bbm}
\usepackage{breqn}
\usepackage{epigraph}
\usepackage{tikz}
\usepackage{tikz-network}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}
\usepackage{xcolor}
\usepackage{setspace}
\usepackage{enumitem}
\usepackage[mathscr]{euscript}
\usepackage{subcaption}
\usepackage{graphicx}
\usepackage{subfiles}
%\usepackage[round]{natbib}
%\usepackage{hyperref}
%\hypersetup{
%    colorlinks=true,
%    linkcolor=blue,
%    citecolor=blue,
%    anchorcolor=blue,
%    filecolor=magenta,
%    urlcolor=cyan,
%    pdftitle={Digital Supply Chains [Boysel 2022]}
%}
%\setlength{\parindent}{0pt}
%\setlength{\parskip}{1em}
%\usepackage{titlesec}
%\titlespacing\section{0pt}{12pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}
%\titlespacing\subsection{0pt}{12pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}
%\titlespacing\subsubsection{0pt}{12pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}
%\usepackage{fancyhdr}
\usepackage{caption}
%%\captionsetup[table]{skip=10pt}
\usepackage{tabularx}
\usepackage{threeparttable}
\usepackage{array}
\newcolumntype{Y}{>{\centering\arraybackslash}X}
\newcolumntype{d}[1]{D{.}{.}{#1}} 
\usepackage{booktabs}
%\usepackage{lastpage}

%%% Theorem Environments
\newtheorem{theorem}{Theorem}[section]
%\newtheorem{acknowledgement}{Acknowledgement}
\newtheorem{assumption}{Assumption}
%\newtheorem{algorithm}[theorem]{Algorithm}
%\newtheorem{axiom}[theorem]{Axiom}
%\newtheorem{case}[theorem]{Case}
%\newtheorem{claim}[theorem]{Claim}
%\newtheorem{conclusion}[theorem]{Conclusion}
%%\newtheorem{condition}[theorem]{Condition}
%\newtheorem{conjecture}[theorem]{Conjecture}
%\newtheorem{corollary}[theorem]{Corollary}
%\newtheorem{criterion}[theorem]{Criterion}
%\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
%\newtheorem{exercise}[theorem]{Exercise}
%\newtheorem{lemma}[theorem]{Lemma}
%\newtheorem{notation}[theorem]{Notation}
%\newtheorem{problem}[theorem]{Problem}
\newtheorem{proposition}{Proposition}
\newtheorem*{remark}{Remark}
%\newtheorem{solution}[theorem]{Solution}
%\newtheorem{summary}[theorem]{Summary}

%%% New Macros
\renewcommand\qed{$\blacksquare$}
\newcommand{\st}{\, s.t. \,}
\newcommand{\grad}{\bigtriangledown}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathSymbol{\shortminus}{\mathbin}{AMSa}{"39}
\newcommand{\Cov}{\mathrm{Cov}}

%% URLs %%%
\urldef\urllibiosourcerank\url{https://docs.libraries.io/overview.html#sourcerank}

\newif\ifdissertation
\dissertationtrue     % (or \dissertationfalse for the standalone)

%% chapter appendices %%%
%%%% source: https://tex.stackexchange.com/q/120716/188684

\usepackage[titles]{tocloft}
%\setcounter{tocdepth}{2}
\usepackage{appendix}
\usepackage{chngcntr}
\usepackage{etoolbox}

% Start of subappendices environment
\AtBeginEnvironment{subappendices}{%
\chapter*{Appendices}
\addcontentsline{toc}{section}{Appendices}
\counterwithin{figure}{section}
\counterwithin{table}{section}
}
% End of subappendices environment
\AtEndEnvironment{subappendices}{%
\counterwithout{figure}{section}
\counterwithout{table}{section}
}

%% Bibliography %%%
\addbibresource{../intro/references.bib}
\addbibresource{../pub-goods/references.bib}
\addbibresource{../formation/references.bib}

%% Figures %%%
\graphicspath{{../pub-goods/figures/}{../formation/figures/}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% front matter %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

% title should be all caps
\title{[DISSERTATION TITLE]}

% use your full name!
% https://cs.stanford.edu/~knuth/news19.html
% "Let's celebrate everybody's full names"
\author{[Full Name]}

% major should be all caps
\majorfield{[MAJOR]}

% date should be May, August, or December (when degrees are conferred)
\submitdate{August 20XX}

%%% preface %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{preface}
  \prefacesection{Dedication}
  \input{dedication.tex}

  \prefacesection{Acknowledgements}
  \input{acknowledgements.tex}

  {
  \hypersetup{hidelinks} % color all links black in the preface
  \tableofcontents
  % fix numwidth for subappendix figs/tables
  \makeatletter
    \def\l@table{\@dottedtocline{1}{1em}{4em}}
    \def\l@figure{\@dottedtocline{1}{1em}{4em}}
    \onehalfspacing
  \makeatother
  \listoftables
  \listoffigures
  }

  \prefacesection{Abstract}
  \input{abstract.tex}
\end{preface}

%%% introduction %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Introduction}\label{ch:introduction}

%\graphicspath{}
\input{../intro/intro.tex}

%%% chapter %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% if you're "stapling" together papers, it's easy to include your paper
% directory by way of symlinks, or copying the entire paper as a
% subdirectory.
%
% for example, if your paper directory looks like the following:
%
%   foobar/          - top level paper directory
%   foobar/fig/      - where all graphics and figures live
%   foobar/paper.bib - bibliography
%   foobar/paper.tex - monolithic .tex file for paper
%
% then you might use the folloiwng:
%
%   \graphicspath{foobar/fig}
%   \addbibresource{foobar/paper.bib}
%   \input{foobar/paper.tex}
%
% note that you'll have to modify the input file to make sure that the
% preamble (\documentclass, etc.) isn't included. to make your life
% easier, you could use some TeX conditionals to make it seamless.
%
% this requires some planning, but enables you to edit the individual
% paper and thesis chapter without tracking and porting changes between
% multiple directories and repositories:
%
% for example, at the beginning of foobar/paper.tex (before
% \documentclass):
%
%   \newif\ifdissertation
%   \dissertationtrue      % (or \dissertationfalse for the standalone)
%
%   \ifdissertation
%   \else
%   \documentclass...
%   \fi
%
%   \ifdissertation
%   \else
%   \begin{document}
%   \fi
%
%   [...paper content here...]
%
%   \ifdissertation
%   \else
%   \end{document}
%   \fi

%%% chapters: lorem ipsum %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% The following text is to test ToC alignment:
% - of extremely long chapter, section, subsection, and
%   subsubsection titles
% - when chapter numbers are double digits

% \chapter{This is a very long title which will take up more than one line
% lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod
% tempor incididunt ut labore et dolore magna aliqua. Ultrices vitae
% auctor eu augue ut lectus arcu. Enim nunc faucibus a pellentesque sit
% amet porttitor eget. Consequat mauris nunc congue nisi vitae.}
%   \label{ch:long-title}

% \section{Ut enim ad minim veniam, quis nostrud exercitation ullamco
% laboris nisi ut aliquip ex ea commodo consequat}

% \subsection{Duis aute irure dolor in reprehenderit in voluptate velit
% esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat
% cupidatat non proident, sunt in culpa qui officia deserunt mollit anim
% id est laborum.}

% \subsubsection{Etiam erat velit scelerisque in dictum non. Sit amet
% justo donec enim diam. Amet justo donec enim diam. Metus vulputate eu
% scelerisque felis imperdiet proin. In nulla posuere sollicitudin aliquam
% ultrices. Turpis in eu mi bibendum.}

% \chapter{Lorem Ipsum}
% \chapter{Lorem Ipsum}
% \chapter{Lorem Ipsum}
% \chapter{Lorem Ipsum}
% \chapter{Lorem Ipsum}
% \chapter{Lorem Ipsum}
% \chapter{Lorem Ipsum}
% \chapter{Lorem Ipsum}
% \chapter{Etiam erat velit scelerisque in dictum non. Sit amet
% justo donec enim diam. Amet justo donec enim diam. Metus vulputate eu
% scelerisque felis imperdiet proin. In nulla posuere sollicitudin aliquam
% ultrices. Turpis in eu mi bibendum.}

% \begin{table}
% \centering
% \begin{tabular}{lS}
% \toprule
% $x$      & \textbf{value} \\
% \midrule
% a        & 1.23           \\
% b        & 3.456          \\
% c        & 100.0002       \\
% d        & 12345.0        \\
% \bottomrule
% \end{tabular}
% \caption[In hendrerit gravida rutrum quisque non tellus orci ac. Iaculis
%         urna id volutpat lacus laoreet non curabitur gravida arcu. Mauris
%         ultrices eros in cursus turpis massa. Sed tempus urna et pharetra
%         pharetra massa massa. Eget sit amet tellus cras adipiscing enim eu
%         turpis egestas. Morbi blandit cursus risus at ultrices.]
%         {In hendrerit gravida rutrum quisque non tellus orci ac. Iaculis
%         urna id volutpat lacus laoreet non curabitur gravida arcu.
%         Mauris ultrices eros in cursus turpis massa. Sed tempus urna et
%         pharetra pharetra massa massa. Eget sit amet tellus cras
%         adipiscing enim eu turpis egestas. Morbi blandit cursus risus at
%         ultrices.}
% \label{tbl:example-2}
% \end{table}

%%% chapter 1 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Quid Pro Code: Peer Effects and Productivity in Open Source Software}
\label{ch:pg}

\section{Introduction} \label{sec:pg-intro}
\subfile{../pub-goods/intro/intro.tex}

\section{Background} \label{sec:pg-background}
\subfile{../pub-goods/background/background.tex}

\section{Literature} \label{sec:pg-lit}
\subfile{../pub-goods/lit/lit.tex}

\section{Data} \label{sec:pg-data}
\subfile{../pub-goods/data/data.tex}

\section{Reduced Form} \label{sec:pg-reduced}
\subfile{../pub-goods/reduced/reduced.tex}

\section{Structural Model} \label{sec:pg-structural}
\subfile{../pub-goods/struct/struct.tex}

\section{Discussion} \label{sec:pg-discussion}
\subfile{../pub-goods/discussion/discussion.tex}

\clearpage
\begin{subappendices}
\section{Tables} \label{app:pg-tables}
\subfile{../pub-goods/appendix/tables/tables.tex}

\clearpage
\section{Figures} \label{app:pg-figures}
\subfile{../pub-goods/appendix/figures/figures.tex}

\clearpage
\section{Data Details} \label{app:pg-data-app}
\subfile{../pub-goods/appendix/data/data.tex}

\clearpage
\onehalfspacing
\section{Additional Reduced Form Results} \label{app:pg-reduced-details}
\subfile{../pub-goods/appendix/reduced-details/reduced-details.tex}

\clearpage
\onehalfspacing
\section{Structural Estimation Details} \label{app:pg-estim-details}
\subfile{../pub-goods/appendix/estim/estim.tex}

\end{subappendices}

%%% chapter 2 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{No Free Lunch For Programmers: Digital Supply Chains and the Economics of Software Dependency Management}
\label{ch:dsc}

\section{Introduction}\label{sec:dsc-intro}
\subfile{../formation/intro/intro}

\section{Literature}\label{sec:dsc-lit}
\subfile{../formation/lit/lit}

\section{Framework}\label{sec:dsc-framework}
\subfile{../formation/framework/framework}

\section{Data}\label{sec:pg-data}
\subfile{../formation/data/data}

\section{Reduced Form}\label{sec:dsc-reduced}
\subfile{../formation/reduced/reduced}

\section{Structural Approach}\label{sec:dsc-structural}
\subfile{../formation/structural/structural}

\section{Counterfactual Analysis}\label{sec:dsc-counterfactual}
\subfile{../formation/counterfactual/counterfactual}

\section{Discussion}\label{sec:dsc-discussion}
\subfile{../formation/discussion/discussion}

\clearpage
\begin{subappendices}
\section{Figures}\label{app:dsc-figures}
\subfile{../formation/appendix/figures/figures.tex}

\clearpage
\section{Tables}\label{app:dsc-tables}
\subfile{../formation/appendix/tables/tables.tex}

\clearpage
\section{Mathematical Details}\label{app:dsc-math}
\subfile{../formation/appendix/math/math.tex}

\clearpage
\section{Estimation Details}\label{app:dsc-estimation}
\subfile{../formation/appendix/estimation/estimation.tex}

\end{subappendices}

% %%% conclusions %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \chapter{Conclusions}
%   \label{ch:conclusions}

% \graphicspath{}
% \input{conclusions}

%%% bibliography %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  \printbibliography in biblatex is great, but doesn't allow for the
%  greatest customization, so we'll use the package biblatex + biber
%  backend to meet some requirements:
%
%  * bibliography should be an un-numbered chapter, and still have a
%    pdfbookmark and a line in the table of contents
%
%  * bibliography contents should be singlespace, and optionally a smaller
%    font
%
%  * first line of this "chapter" should be in the same spot as the first
%    line of preface sections (e.g., acknowledgement)
%
%  * we use \raggedright so things like URLs and DOIs aren't stretched out.
%
\clearpage
\chapter*{Bibliography}
\addcontentsline{toc}{chapter}{Bibliography}

\begin{singlespace}
  % increase penalty such that we don't break entries over pages
  % source: https://tex.stackexchange.com/a/43275
  \patchcmd{\bibsetup}{\interlinepenalty=5000}{\interlinepenalty=10000}{}{}

  % reduce spacing between each bibentry
  \setlength\bibitemsep{0.9\baselineskip}

  % don't justify-align entries: this prevents stretching out each line
  \raggedright
  \printbibliography[
    heading = none
  ]
\end{singlespace}

\end{document}
